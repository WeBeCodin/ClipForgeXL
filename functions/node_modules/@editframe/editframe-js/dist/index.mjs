var Jr=Object.create;var Pi=Object.defineProperty;var Qr=Object.getOwnPropertyDescriptor;var Zr=Object.getOwnPropertyNames;var eo=Object.getPrototypeOf,to=Object.prototype.hasOwnProperty;var io=(e,i)=>()=>(i||e((i={exports:{}}).exports,i),i.exports);var ro=(e,i,r,o)=>{if(i&&typeof i=="object"||typeof i=="function")for(let n of Zr(i))!to.call(e,n)&&n!==r&&Pi(e,n,{get:()=>i[n],enumerable:!(o=Qr(i,n))||o.enumerable});return e};var oo=(e,i,r)=>(r=e!=null?Jr(eo(e)):{},ro(i||!e||!e.__esModule?Pi(r,"default",{value:e,enumerable:!0}):r,e));var vr=io((gs,Lr)=>{"use strict";var Ft=Object.defineProperty,ao=Object.getOwnPropertyDescriptor,so=Object.getOwnPropertyNames,lo=Object.prototype.hasOwnProperty,mo=(e,i)=>{for(var r in i)Ft(e,r,{get:i[r],enumerable:!0})},po=(e,i,r,o)=>{if(i&&typeof i=="object"||typeof i=="function")for(let n of so(i))!lo.call(e,n)&&n!==r&&Ft(e,n,{get:()=>i[n],enumerable:!(o=ao(i,n))||o.enumerable});return e},uo=e=>po(Ft({},"__esModule",{value:!0}),e),Ui={};mo(Ui,{AudioKey:()=>cr,Color:()=>Hi,CompositionKey:()=>Wi,ConfigKey:()=>Xi,DefaultAudio:()=>dn,DefaultAudioOptions:()=>Ve,DefaultHtmlOptions:()=>Zi,DefaultLottieOptions:()=>tr,DefaultPosition:()=>To,DefaultPositionOptions:()=>Dt,DefaultSize:()=>Do,DefaultSizeOptions:()=>St,DefaultSubtitlesOptions:()=>rr,DefaultTextOptions:()=>mr,DefaultTimeline:()=>So,DefaultTimelineOptions:()=>Et,DefaultTransitions:()=>Dn,DefaultTrim:()=>Eo,DefaultTrimOptions:()=>Vt,DefaultWaveformOptions:()=>fr,DimensionsKey:()=>Mi,EasingType:()=>Pn,EffectKey:()=>hr,EffectName:()=>kn,EffectOptionKey:()=>gr,FilterKey:()=>xr,FilterName:()=>Bn,FilterOptionKey:()=>br,FontStyleValue:()=>Yo,FontWeightValue:()=>qo,FormatValue:()=>_o,HtmlKey:()=>Ji,HtmlPageKey:()=>Qi,LayerConfigDefaults:()=>ln,LayerDefaults:()=>sn,LayerHorizontalAlignmentValue:()=>bo,LayerKey:()=>Gi,LayerType:()=>Ni,LayerVerticalAlignmentValue:()=>xo,LottieKey:()=>er,OptimisticCanvasDefaultSize:()=>fo,PositionKey:()=>$i,SizeKey:()=>ji,SubtitlesKey:()=>ir,TextAlignValue:()=>sr,TextBaseline:()=>or,TextHorizontalPositionValue:()=>Co,TextKey:()=>dr,TextPositionToAlignItems:()=>Go,TextPositionToJustifyContent:()=>No,TextVerticalPositionValue:()=>Po,TimelineKey:()=>qi,TransitionKey:()=>yr,TransitionOptionKey:()=>_n,TransitionType:()=>vn,TrimKey:()=>Yi,VideoExtensions:()=>Bi,WaveformKey:()=>ur,WaveformStyleValue:()=>pr,XPositionToJustifyContent:()=>Lo,YPositionToAlignItems:()=>vo});Lr.exports=uo(Ui);var fo=1e4,Hi=(e=>(e.black="#000000FF",e.transparent="transparent",e.white="#FFFFFFFF",e))(Hi||{}),Mi=(e=>(e.height="height",e.width="width",e))(Mi||{}),Wi=(e=>(e.backgroundColor="backgroundColor",e.dimensions="dimensions",e.duration="duration",e.extension="extension",e.filename="filename",e.files="files",e.fps="fps",e.layers="layers",e.metadata="metadata",e.thumbnail="thumbnail",e))(Wi||{}),Bi=(e=>(e.mov="mov",e.mp4="mp4",e.webm="webm",e))(Bi||{}),co="bottom",yo="top",_t="center",go="left",ho="right",bo={center:_t,left:go,right:ho},xo={bottom:co,center:_t,top:yo},$i=(e=>(e.angle="angle",e.angleX="angleX",e.angleY="angleY",e.isRelative="isRelative",e.origin="origin",e.x="x",e.y="y",e.z="z",e))($i||{}),Lo={center:"center",left:"flex-start",right:"flex-end"},vo={bottom:"flex-end",center:"center",top:"flex-start"},Dt={angle:0,angleX:0,angleY:0,isRelative:!1,origin:_t,x:0,y:0,z:0},To={position:Dt},Ao="fill",wo="fit",Fo="stretch",_o={fill:Ao,fit:wo,stretch:Fo},ji=(e=>(e.format="format",e.height="height",e.scale="scale",e.width="width",e))(ji||{}),St={format:void 0,height:void 0,scale:1,width:void 0},Do={size:St},qi=(e=>(e.start="start",e))(qi||{}),Et={start:0},So={timeline:Et},Yi=(e=>(e.end="end",e.start="start",e))(Yi||{}),Vt={end:void 0,start:0},Eo={trim:Vt},Gi=(e=>(e.audio="audio",e.filter="filter",e.effect="effect",e.html="html",e.id="id",e.lottie="lottie",e.position="position",e.size="size",e.subtitles="subtitles",e.source="source",e.text="text",e.timeline="timeline",e.transitions="transitions",e.trim="trim",e.type="type",e.waveform="waveform",e.wordCount="wordCount",e))(Gi||{}),Ni=(e=>(e.audio="audio",e.effect="effect",e.filter="filter",e.group="group",e.html="html",e.image="image",e.lottie="lottie",e.sequence="sequence",e.subtitles="subtitles",e.text="text",e.video="video",e.waveform="waveform",e))(Ni||{}),Xi=(e=>(e.backgroundColor="backgroundColor",e.dimensions="dimensions",e.duration="duration",e.extension="extension",e.fps="fps",e.layers="layers",e.metadata="metadata",e.shouldWatermark="shouldWatermark",e))(Xi||{}),Ve={volume:1,normalize:!1},Ji=(e=>(e.page="page",e.selector="selector",e.url="url",e.withTailwind="withTailwind",e.withTransparentBackground="withTransparentBackground",e.framesDirectory="framesDirectory",e.framesCount="framesCount",e))(Ji||{}),Qi=(e=>(e.body="body",e.styles="styles",e))(Qi||{}),Zi={page:void 0,selector:void 0,url:void 0,withTailwind:!1,withTransparentBackground:!1},er=(e=>(e.assets="assets",e.ddd="ddd",e.fonts="fonts",e.fr="fr",e.h="h",e.ip="ip",e.layers="layers",e.markers="markers",e.meta="meta",e.nm="nm",e.op="op",e.v="v",e.w="w",e))(er||{}),tr={},ir=(e=>(e.backgroundColor="backgroundColor",e.color="color",e.fontSize="fontSize",e))(ir||{}),rr={backgroundColor:"#000000FF",color:"#FFFFFFFF",fontSize:32},or=(e=>(e.alphabetic="alphabetic",e.bottom="bottom",e.hanging="hanging",e.ideographic="ideographic",e.middle="middle",e.top="top",e))(or||{}),Vo="bottom",It="center",Io="justify",nr="left",ar="right",Oo="top",sr={center:It,justify:Io,left:nr,right:ar},Co={center:It,left:nr,right:ar},Po={bottom:Vo,center:It,top:Oo},Ko="bold",ko="italic",lr="normal",zo=100,Ro=200,Uo=300,Ho=400,Mo=500,Wo=600,Bo=700,$o=800,jo=900,qo={_100:zo,_200:Ro,_300:Uo,_400:Ho,_500:Mo,_600:Wo,_700:Bo,_800:$o,_900:jo,bold:Ko,normal:lr},Yo={italic:ko,normal:lr},Go={bottom:"flex-end",center:"center",top:"flex-start"},No={center:"center",left:"flex-start",right:"flex-end"},dr=(e=>(e.backgroundColor="backgroundColor",e.backgroundTransform="backgroundTransform",e.border="border",e.borderRadius="borderRadius",e.color="color",e.fontFamily="fontFamily",e.fontSize="fontSize",e.fontStyle="fontStyle",e.fontWeight="fontWeight",e.lineHeight="lineHeight",e.padding="padding",e.tailwind="tailwind",e.text="text",e.textAlign="textAlign",e.textDecoration="textDecoration",e.textPosition="textPosition",e.textTransform="textTransform",e.textStroke="textStroke",e.textFillColor="textFillColor",e.textShadow="textShadow",e))(dr||{}),mr={backgroundColor:"transparent",backgroundTransform:"none",border:"none",borderRadius:0,color:"#FFFFFFFF",fontFamily:"Helvetica",fontSize:100,fontStyle:"normal",fontWeight:400,lineHeight:1.2,padding:16,tailwind:void 0,text:"Your Text Here...",textAlign:sr.left,textDecoration:"none",textPosition:void 0,textTransform:"none",textFillColor:void 0,textStroke:void 0,textShadow:void 0},Xo="bars",Jo="barsVertical",Qo="bricks",Zo="curve",en="equalizer",tn="line",rn="pixel",on="roundBars",nn="wave",an="waveSmooth",pr={bars:Xo,barsVertical:Jo,bricks:Qo,curve:Zo,equalizer:en,line:tn,pixel:rn,roundBars:on,wave:nn,waveSmooth:an},ur=(e=>(e.backgroundColor="backgroundColor",e.color="color",e.secondaryColor="secondaryColor",e.data="data",e.style="style",e.numberOfFrames="numberOfFrames",e.waveforms="waveforms",e))(ur||{}),fr={backgroundColor:"transparent",color:"#FFFFFFFF",style:pr.bars},sn={audio:Ve,html:Zi,lottie:tr,subtitles:rr,text:mr,waveform:fr},ln={audio:Ve,position:Dt,size:St,timeline:Et,transitions:[],trim:Vt},cr=(e=>(e.volume="volume",e.normalize="normalize",e))(cr||{}),dn={audio:Ve},mn="crossfadeIn",pn="crossfadeOut",un="fadeIn",fn="fadeOut",cn="kenBurns",yn="angle",gn="angleX",hn="angleY",bn="scale",xn="x",Ln="y",vn={crossfadeIn:mn,crossfadeOut:pn,fadeIn:un,fadeOut:fn,kenBurns:cn,angle:yn,angleX:gn,angleY:hn,scale:bn,x:xn,y:Ln},Tn="duration",An="easing",wn="time",Fn="value",_n={duration:Tn,easing:An,time:wn,value:Fn},yr=(e=>(e.duration="duration",e.options="options",e.type="type",e))(yr||{}),Dn={transitions:[]},Sn="easeIn",En="easeInOut",Vn="easeOut",In="elasticIn",On="elasticInOut",Cn="elasticOut",Pn={easeIn:Sn,easeInOut:En,easeOut:Vn,elasticIn:In,elasticInOut:On,elasticOut:Cn},Kn="normalize",kn={normalize:Kn},gr=(e=>(e.normalize="normalize",e))(gr||{}),hr=(e=>(e.name="name",e.options="options",e))(hr||{}),zn="brightness",Rn="contrast",Un="grayscale",Hn="lighten",Mn="negative",Wn="saturation",Bn={brightness:zn,contrast:Rn,grayscale:Un,lighten:Hn,negative:Mn,saturation:Wn},br=(e=>(e.brightness="brightness",e.contrast="contrast",e.grayscale="grayscale",e.saturation="saturation",e))(br||{}),xr=(e=>(e.name="name",e.options="options",e))(xr||{})});var Ki="https://api.editframe.com";import ki from"audio-extensions";import no from"image-extensions";import zi from"video-extensions";var Ri={_1080p:{height:1080,width:1920},_1080pVertical:{height:1920,width:1080},_1080x1080:{height:1080,width:1080},_720p:{height:720,width:1080},_720pVertical:{height:1080,width:720},_720x720:{height:720,width:720}};var P={applications:{all:"/applications",get:"/applications/:id"},metadata:"/metadata",videos:{all:"/videos",create:"/videos",get:"/videos/:id",new:"/videos/new"},flows:{all:"/flows",run:"/flows/run",get:"/flows/:id"},ws:{auth:"/broadcasting/auth"},assets:"/assets"};var t=oo(vr());var Ot={[t.EffectName.normalize]:{[t.EffectOptionKey.normalize]:"boolean"}};var Ct={name:void 0,options:void 0},Tr={effect:Ct};var Pt={[t.FilterName.brightness]:{[t.FilterOptionKey.brightness]:"number"},[t.FilterName.contrast]:{[t.FilterOptionKey.contrast]:"number"},[t.FilterName.saturation]:{[t.FilterOptionKey.saturation]:"number"}};var Kt={name:void 0,options:void 0},Ar={filter:Kt};var wr=[t.LayerType.audio,t.LayerType.video];var Fr=[t.LayerType.html,t.LayerType.image,t.LayerType.lottie,t.LayerType.text,t.LayerType.video,t.LayerType.waveform];var _r=[t.LayerType.html,t.LayerType.image,t.LayerType.lottie,t.LayerType.text,t.LayerType.video,t.LayerType.waveform];var Dr=[t.LayerType.audio,t.LayerType.html,t.LayerType.image,t.LayerType.lottie,t.LayerType.text,t.LayerType.video,t.LayerType.waveform];var Sr=[t.LayerType.audio,t.LayerType.html,t.LayerType.image,t.LayerType.lottie,t.LayerType.text,t.LayerType.video,t.LayerType.waveform];var Er=[t.LayerType.audio,t.LayerType.html,t.LayerType.image,t.LayerType.lottie,t.LayerType.text,t.LayerType.video,t.LayerType.waveform];var ee="./.preview",Vr=`${ee}/config.json`,Ir="9876";import Yn from"camelcase-keys";import Or from"cross-fetch";var kt={requestUnsuccessful:(e,i)=>`${e} - ${i}`};var de={get:e=>`Error getting applications: ${e}`,malformedResponse:"malformed `applications` response"};import $n from"chalk";var jn={tokenRequired:`\\${$n.white("token")}\\ must be provided to constructor`};import zt from"chalk";var Y={all:e=>`Error getting flows: ${e}`,get:e=>`Error getting flow: ${e}`,malformedResponse:"malformed `flow` response",new:e=>`Error creating new flow: ${e}`,malformedEncodingResponse:"malformed `flow` response",invalidDeliverables:"invalid `deliverables` object",optionsRequired:`\\${zt.white("options")}\\ must be provided`,jobsRequired:`\\${zt.white("jobs")}\\ must be provided`,jobsNotEmpty:`\\${zt.white("jobs")}\\ you must added at least a job`};import F from"chalk";var s={FILE_DOES_NOT_EXIST:e=>`\\${F.white(e)}\\ is not a valid path`,INVALID_COLOR:(e,i,r)=>`\\${F.white(i)} attribute in \\${F.white(e)}\\ is not a valid color. Got \\${F.white(r)}\\`,INVALID_OPTIONS:(e,i,r)=>`
  \\${F.white("options")}\\ attribute in \\${F.white(e)}\\ should contain keys \\${F.white(JSON.stringify(i))}\\. Got: \\${F.white(JSON.stringify(r))}\\`,INVALID_URL:e=>`\\${F.white(e)}\\ is not valid url`,INVALID_VIDEO_EXTENSION:(e,i,r)=>`
  \\${F.white(e)}\\ attribute should contain one of these keys \\${F.white(JSON.stringify(i))}\\. Got: \\${F.white(JSON.stringify(r))}\\`,MUST_BE_TYPE:(e,i,r,o)=>`
  \\${F.white(i)}\\ attribute in \\${F.white(e)}\\ must be of type \\${F.white(o)}\\. Got: \\${F.white(JSON.stringify(r))}\\`,OR:e=>e.join(" | "),REQUIRED_FIELD:e=>`\\${F.white(e)}\\ field is required`,SUB_FIELD:(e,i)=>`${e}: { ${i} }`,TWO_TRANSITIONS_REQUIRED:(e,i)=>`Only one transition of type \\${F.white(e)}\\ has been added to layer of type \\${F.white(i)}\\. There must be at least two transitions added in order to interpolate between the transition values`,INVALID_FLOW_TYPE:e=>`\\${F.white(e)}\\ is not valid url`,INVALID_TRIM_VALUE_GREATER_THAN_DURATION:(e,i,r,o)=>`Layer trim end value ${F.white(e)}s is greater than ${i}s file duration -  file: ${o}, method: ${r}`,INVALID_TRIM_VALUE_LESS_THAN_DURATION:(e,i,r,o)=>`Layer trim start value ${F.white(e)}s is less than ${i}s file duration - file: ${o}, method: ${r}`};import H from"chalk";var A={dataRequired:`\\${H.white("data")}\\ must be provided`,dimensionsRequired:`\\${H.white("dimensions")}\\ must be provided unless a \\${H.white("videoFile")}\\ is provided`,durationRequired:`\\${H.white("duration")}\\ must be provided unless composition is instantiated from a \\${H.white("videoFile")}\\ or calculated automatically via a call to \\${H.white("addSequence")}\\`,errorEncoding:e=>`Error encoding video: ${e}`,filterRequired:`\\${H.white("filter")}\\ must be provided`,htmlPageOrUrlRequired:`Either \\${H.white("page")}\\ or \\${H.white("url")}\\ must be provided`,malformedEncodingResponse:`malformed \\${H.white("encoding")}\\ response`,optionsRequired:`\\${H.white("options")}\\ must be provided`,textRequired:`\\${H.white("text")}\\ field required`,trimEndRequired:e=>`layer \\${H.white(e)}\\ must provide \\${H.white(s.SUB_FIELD(t.LayerKey.trim,t.TrimKey.end))}\\ attribute in order to calculate position in sequence timeline automatically`,validationOptionsError:e=>`Error: ${e}`,videoEncodingFailed:(e,i)=>`Video encoding failed: ${e} ${i?`(${i})`:""}`,htmlUrlInvalid:e=>`\\${H.white(e)}\\ is invalid`,htmlUrlProtocolRequired:`\\${H.white("url")}\\ must include a protocol (e.g. http:// or https://)`};import Rt from"chalk";var X={invalidFileSource:e=>`Invalid file source provided for \\${Rt.white(e)}\\`,invalidFileSourceUrl:(e,i)=>`Invalid file source url provided for \\${Rt.white(e)}\\ \\${Rt.white(i)}\\`};var j={all:e=>`Error getting videos: ${e}`,get:e=>`Error getting video: ${e}`,malformedResponse:"malformed `videos` response",new:e=>`Error creating new video: ${e}`};var Ut="4.3.0";var Ht=(e,i)=>`${e}/v${i}`,Mt=e=>Nn(Gn(e)),Gn=e=>i=>i.url.startsWith("/")?Or(`${e}${i.url}`,i):Or(i.url,i),Nn=e=>async({data:i,headers:r,method:o,url:n})=>{r["Content-Type"]==="application/json"&&(i=JSON.stringify(i));let a=await e({body:i,headers:r,method:o,url:n});if(!a.ok)throw new Error(kt.requestUnsuccessful(a.url,a.statusText));let f=await a.json(),m=Yn(f,{deep:!0});return m.data&&!m.links&&!m.meta?m.data:m},ye=({isForm:e=!1,token:i})=>{let r={["User-Agent"]:`${"editframe.js/"}${Ut}`,["Authorization"]:`${"Bearer "}${i}`};return e?(r["Accept"]="application/json",r["X-Requested-With"]="XMLHttpRequest"):(r["Content-Type"]="application/json",r["Accept"]="application/json"),r["X-SDK-Version"]=`${Ut}`,r};import{ColorTranslator as Xn}from"colortranslator";var D=e=>e===t.Color.transparent?t.Color.transparent:Xn.toHEXA(e);import Jn from"lodash.clonedeep";import Qn from"lodash.merge";var x=Jn,h=Qn;var Wt=()=>{let e={};return h(e,t.DefaultTimeline,t.DefaultTransitions,t.DefaultTrim),e},Ie=()=>{let e={audio:t.DefaultAudioOptions};return h(e,Wt()),e};var Cr=()=>{let e={};return h(e,{audio:{volume:void 0}},{position:{angle:void 0,angleX:void 0,angleY:void 0,isRelative:void 0,origin:void 0,x:void 0,y:void 0}},{size:{format:void 0,height:void 0,scale:void 0,width:void 0}},{timeline:{start:void 0}},{transitions:[]},{trim:{end:void 0,start:void 0}}),e},Bt=()=>{let e={};return h(e,Cr()),e};var $t=()=>{let e={};return h(e,t.DefaultPosition,t.DefaultSize,t.DefaultTimeline,t.DefaultTransitions,t.DefaultTrim),e},Oe=()=>{let e={html:t.DefaultHtmlOptions};return h(e,$t()),e};var jt=()=>{let e={};return h(e,t.DefaultPosition,t.DefaultSize,t.DefaultTimeline,t.DefaultTransitions,t.DefaultTrim),e},Ce=()=>{let e={};return h(e,jt()),e};var qt=()=>{let e={};return h(e,t.DefaultPosition,t.DefaultSize,t.DefaultTimeline,t.DefaultTransitions,t.DefaultTrim),e},Pe=()=>{let e={lottie:{}};return h(e,{lottie:t.DefaultLottieOptions},qt()),e};var Yt=()=>{let e={};return h(e,t.DefaultTimeline),e},Ke=()=>{let e={};return h(e,Yt()),e};var ke=({height:e,width:i})=>({size:{format:null,height:e,width:i}});var Gt=()=>{let e={};return h(e,{position:{isRelative:!0,x:t.LayerHorizontalAlignmentValue.center,y:.85}},t.DefaultTimeline,t.DefaultTransitions,t.DefaultTrim),e},ze=()=>{let e={subtitles:t.DefaultSubtitlesOptions};return h(e,Gt()),e};var Nt=()=>{let e={};return h(e,t.DefaultPosition,t.DefaultSize,t.DefaultTimeline,t.DefaultTransitions,t.DefaultTrim),e},Re=()=>{let e={text:t.DefaultTextOptions};return h(e,Nt()),e};var Xt=()=>{let e={};return h(e,t.DefaultAudio,t.DefaultPosition,t.DefaultSize,t.DefaultTimeline,t.DefaultTransitions,t.DefaultTrim),e},Ue=()=>{let e={};return h(e,Xt()),e};var Jt=e=>{let i={};return h(i,t.DefaultPosition,ke(e),t.DefaultTimeline,t.DefaultTransitions,t.DefaultTrim),i},He=e=>{let i={waveform:t.DefaultWaveformOptions};return h(i,Jt(e)),i};import Zn from"chalk";var Me=e=>console.error(Zn.yellow(e));import{fetch as oa}from"cross-fetch";import na from"mime";import aa,{createWriteStream as sa,existsSync as Kr,mkdirSync as la,rmSync as da,writeFileSync as ma}from"fs";import{parse as pa}from"path";import ua from"temp-dir";import{compile as ea}from"path-to-regexp";import ta from"query-string";var ia=e=>ea(e),oe=(e="/",i={})=>e==="/"?e:ia(e)(i,{pretty:!0}),Qt=e=>{let i=new URL(e);return i.hash="",i.search="",i.toString()},Pr=(e,i)=>{let r=ta.stringify(i);return`${e}${r?`?${r}`:""}`},ne=(e,i,r)=>Pr(e,{["page"]:i,["per_page"]:r});import{v4 as ra}from"uuid";var me=()=>ra().slice(0,6);var We=e=>{Kr(e)||la(e,{recursive:!0})},te=e=>aa.createReadStream(e),ge=()=>{let e=`${ua}/${me()}`;return We(e),e},Zt=async(e,i)=>{let r=await oa(e),o=r.headers.get("Content-Type"),n=`${i}/${me()}${Be(Qt(e),o)}`,a=sa(n);return await new Promise((f,m)=>{r.body.pipe(a),r.body.on("error",m),a.on("finish",f)}),{temporaryFilePath:n}},ae=e=>Kr(e),Be=(e,i)=>{let r=pa(e).ext;return r||`.${na.getExtension(i)}`},ei=e=>{ae(e)&&da(e,{recursive:!0})},ti=(e,i)=>ma(e,i);import fa from"form-data";var he=e=>{let i=new fa;return e.forEach(r=>{i.append(r[0],r[1])}),i},J=e=>typeof e==="string"?"url":"file";var $e=()=>{process.env.NODE_ENV!=="test"&&process.exit(1)};import ca from"validate-color";var u=(e,i)=>Array.isArray(i)?i.includes(typeof e):typeof e===i,ii=e=>{try{return kr(e),!0}catch{return!1}},kr=e=>{try{new URL(e)}catch{throw new TypeError(s.INVALID_URL(e))}},G=(e,i,r)=>{r&&Object.keys(r).forEach(o=>{if(!Object.keys(i).includes(o))throw new Error(s.INVALID_OPTIONS(e,Object.keys(i).join(", "),Object.keys(r).join(", ")))})},g=(e,i,r)=>{let o=e.map(n=>n({callerName:i,layer:r})).flat().filter(n=>n!==void 0);if(o.length)throw new TypeError(`Validation Errors: ${o.join(`
`)}`)},I=(e,i)=>{if(e==null)throw new Error(i)},zr=(e,i)=>{if(e.length===0)throw new Error(i)},l=(e,i,r,o,n=!1)=>{if(r&&typeof r!==o){let a=s.MUST_BE_TYPE(e,i,r,o);if(n)throw new TypeError(a);return a}};var be=(e,i,r,o,n=!1)=>{if(r&&!o.includes(r)){let a=s.MUST_BE_TYPE(e,i,r,s.OR(o.map(f=>f.toString())));if(n)throw new TypeError(a);return a}},S=(e,i,r,o=!1)=>{if(l(e,i,r,"string"),!ca(r)){let n=s.INVALID_COLOR(e,i,r);if(o)throw new TypeError(n);return n}},Rr=(e,i,r,o=!1)=>{if(l(e,i,r,"array"),!r[0].type){let n=s.INVALID_FLOW_TYPE(e);if(o)throw new TypeError(n);return n}},Ur=(e,i,r,o=!1)=>{if(l(e,i,r,"string"),!(r in t.VideoExtensions)){let n=s.INVALID_VIDEO_EXTENSION(e,i,r);if(o)throw new TypeError(n);return n}},d=(e,i)=>{try{return e(),i?i():void 0}catch({name:r,stack:o}){Me(o),$e();return}},K=async(e,i,r)=>{try{return e(),i?await i():void 0}catch({name:o,stack:n}){Me(n),$e();return}finally{r&&r()}},v=e=>e!==void 0,Hr=e=>e!==void 0,Mr=e=>/^(https?:\/\/)?([\da-z.-]+)\.([a-z.]{2,6})([/\w .-]*)*\/?$/i.test(e);var ya=e=>"first"in e&&u(e.first,"string")&&"last"in e&&u(e.last,"string"),ga=e=>"active"in e&&u(e.active,"boolean")&&"label"in e&&u(e.label,"string"),ha=e=>"currentPage"in e&&u(e.currentPage,"number")&&"from"in e&&u(e.from,["number","object"])&&"lastPage"in e&&u(e.lastPage,"number")&&"links"in e&&e.links.every(ga)&&"path"in e&&u(e.path,"string")&&"perPage"in e&&u(e.perPage,"number")&&"to"in e&&u(e.to,["number","object"])&&"total"in e&&u(e.total,"number"),se=(e,i)=>"data"in e&&Array.isArray(e.data)&&(e.data.length>0?e.data.every(i):!0)&&"links"in e&&ya(e.links)&&"meta"in e&&ha(e.meta);var pe=e=>"id"in e&&u(e["id"],"string")&&"status"in e&&u(e["status"],"string")&&"timestamp"in e&&u(e["timestamp"],"number"),je=e=>"id"in e&&u(e.id,"string")&&"isReady"in e&&u(e.isReady,"boolean")&&"isFailed"in e&&u(e.isFailed,"boolean"),ri=e=>se(e,je),oi=e=>"bitrate"in e&&u(e.bitrate,"number")&&"codec"in e&&u(e.codec,"string")&&"duration"in e&&u(e.duration,"number")&&"samplerate"in e&&u(e.samplerate,"number")&&"size"in e&&u(e.size,"number"),ni=e=>"codec"in e&&u(e.codec,"string")&&"height"in e&&u(e.height,"number")&&"size"in e&&u(e.size,"number")&&"width"in e&&u(e.width,"number"),xe=e=>"bitrate"in e&&u(e.bitrate,"number")&&"codec"in e&&u(e.codec,"string")&&"duration"in e&&u(e.duration,"number")&&"fps"in e&&u(e.fps,"number")&&"height"in e&&u(e.height,"number")&&"size"in e&&u(e.size,"number")&&"width"in e&&u(e.width,"number");var ai=({backgroundColor:e,dimensions:i,duration:r,extension:o,fps:n,metadata:a})=>{e&&S("new",t.CompositionKey.backgroundColor,e,!0),n&&l("new",t.CompositionKey.fps,r,"number",!0),o&&Ur("new",t.CompositionKey.extension,o,!0),l("new",s.SUB_FIELD(t.CompositionKey.dimensions,t.DimensionsKey.height),i.height,"number",!0),l("new",s.SUB_FIELD(t.CompositionKey.dimensions,t.DimensionsKey.width),i.width,"number",!0),l("new",t.CompositionKey.duration,r,"number",!0),l("new",t.CompositionKey.metadata,a,"object",!0)};var O=(e,i)=>{if(e&&i.validate(e))return e;throw new Error(i.invalidDataError)},Ta={["audio"]:e=>O(e,{invalidDataError:j.malformedResponse,validate:oi}),["image"]:e=>O(e,{invalidDataError:j.malformedResponse,validate:ni}),["video"]:e=>O(e,{invalidDataError:j.malformedResponse,validate:xe})};var qe=e=>"description"in e&&u(e.description,"string")&&"id"in e&&u(e.id,"string")&&"name"in e&&u(e.name,"string")&&"webhook"in e&&u(e.webhook,"string"),si=e=>se(e,qe);import Br from"cross-fetch";import{Readable as $r}from"stream";var Q=(e,i)=>{if(I(i,X.invalidFileSource(e)),typeof i!="string"&&!(i instanceof $r))throw new Error(X.invalidFileSource(e))},le=async(e,i)=>{if(I(i,X.invalidFileSource(e)),typeof i=="string"&&!Mr(i))return!0;let r=async o=>{let n=await Br(o,{method:"HEAD",redirect:"manual"});for(;[301,302,303,307,308].includes(n.status);){let a=n.headers.get("location");if(!a)throw new Error(X.invalidFileSourceUrl(o,e));n=await Br(a,{method:"HEAD",redirect:"manual"})}if(n.status===404||n.status===500)throw new Error(X.invalidFileSourceUrl(o,e))};if(typeof i=="string")try{await r(i)}catch{throw new Error(X.invalidFileSourceUrl(i,e))}else if(!(i instanceof $r))throw new Error(X.invalidFileSource(e));return!0},li=({backgroundColor:e,dimensions:i})=>{let r=[];I(i,A.dimensionsRequired),r.push(l("new",s.SUB_FIELD(t.CompositionKey.dimensions,t.DimensionsKey.height),i.height,"number")),r.push(l("new",s.SUB_FIELD(t.CompositionKey.dimensions,t.DimensionsKey.width),i.width,"number")),r.push(l("new",t.CompositionKey.backgroundColor,e,"string"));let o=r.filter(n=>n!==void 0);if(o.length)throw new TypeError(o.join(`
`))};var Ye=e=>"id"in e&&u(e.id,"string")&&"isReady"in e&&u(e.isReady,"boolean")&&"isFailed"in e&&u(e.isFailed,"boolean"),di=e=>se(e,Ye);var mi=({deliverables:e,jobs:i})=>{e&&l("new","deliverables",e,"object",!0),i&&Rr("new","jobs",i)};var Z=({callerName:e,layer:{audio:{volume:i}}})=>{let r=[];return r.push(l(e,s.SUB_FIELD(t.LayerKey.audio,t.AudioKey.volume),i,"number")),r.filter(v)},Ge=(e,i)=>g([Z],e,i);var wa=(e,i,r)=>{let o=Object.values(t.LayerHorizontalAlignmentValue);if(r&&!o.includes(r))return s.MUST_BE_TYPE(e,i,r,o.join(", "))},Fa=(e,i,r)=>{let o=Object.values(t.LayerVerticalAlignmentValue);if(r&&!o.includes(r))return s.MUST_BE_TYPE(e,i,r,o.join(", "))},pi=(e,i,r)=>{if(r)return typeof r==="string"?wa(e,i,r):l(e,i,r,"number")},ui=(e,i,r)=>{if(r)return typeof r==="string"?Fa(e,i,r):l(e,i,r,"number")},U=({callerName:e,layer:{position:{angle:i,angleX:r,angleY:o,isRelative:n,origin:a,x:f,y:m,z:y}}})=>{let p=[];return p.push(l(e,s.SUB_FIELD(t.LayerKey.position,t.PositionKey.angle),i,"number")),p.push(l(e,s.SUB_FIELD(t.LayerKey.position,t.PositionKey.angleX),r,"number")),p.push(l(e,s.SUB_FIELD(t.LayerKey.position,t.PositionKey.angleY),o,"number")),p.push(l(e,s.SUB_FIELD(t.LayerKey.position,t.PositionKey.isRelative),n,"boolean")),p.push(l(e,s.SUB_FIELD(t.LayerKey.position,t.PositionKey.origin),a,"string")),p.push(l(e,s.SUB_FIELD(t.LayerKey.position,t.PositionKey.z),y,"number")),p.push(pi(e,s.SUB_FIELD(t.LayerKey.position,t.PositionKey.x),f)),p.push(ui(e,s.SUB_FIELD(t.LayerKey.position,t.PositionKey.y),m)),p.filter(v)},q=(e,i)=>g([U],e,i);var W=({callerName:e,layer:{size:{format:i,height:r,scale:o,width:n}}})=>{let a=[];return a.push(be(e,s.SUB_FIELD(t.LayerKey.size,t.SizeKey.format),i,Object.values(t.FormatValue))),a.push(l(e,s.SUB_FIELD(t.LayerKey.size,t.SizeKey.height),r,"number")),a.push(l(e,s.SUB_FIELD(t.LayerKey.size,t.SizeKey.scale),o,"number")),a.push(l(e,s.SUB_FIELD(t.LayerKey.size,t.SizeKey.width),n,"number")),a.filter(v)},ie=(e,i)=>g([W],e,i);var w=({callerName:e,layer:{timeline:{start:i}}})=>{let r=[];return r.push(l(e,s.SUB_FIELD(t.LayerKey.timeline,t.TimelineKey.start),i,"number")),r.filter(v)},Ne=(e,i)=>g([w],e,i);var _a=e=>e&&Object.keys(e).length===1&&t.TransitionOptionKey.duration in e&&u(e[t.TransitionOptionKey.duration],"number"),Da=e=>e&&[2,3].includes(Object.keys(e).length)&&t.TransitionOptionKey.time in e&&u(e[t.TransitionOptionKey.value],"number")&&t.TransitionOptionKey.value in e&&u(e[t.TransitionOptionKey.value],"number"),fi=({callerName:e,layer:{transitions:i}})=>{let r=[];return i.forEach(({options:o,type:n})=>{if(Da(o)?r.push(l(e,s.SUB_FIELD(t.LayerKey.transitions,t.TransitionKey.options),o?.easing,"string"),l(e,s.SUB_FIELD(t.LayerKey.transitions,t.TransitionKey.options),o?.time,"number"),l(e,s.SUB_FIELD(t.LayerKey.transitions,t.TransitionKey.options),o?.value,"number")):_a(o)&&r.push(l(e,s.SUB_FIELD(t.LayerKey.transitions,t.TransitionKey.options),o?.duration,"number")),!Object.values(t.TransitionType).includes(n)){let f=s.MUST_BE_TYPE(e,t.TransitionKey.type,n,`${Object.values(t.TransitionType).join(", ")}`);r.push(f)}}),r.filter(v)},Xe=e=>{let i="";if(e.forEach(r=>{"transitions"in r&&r.transitions.length&&r.transitions.filter(o=>o.type!==t.TransitionType.kenBurns).forEach(o=>{![t.TransitionType.crossfadeIn,t.TransitionType.crossfadeOut,t.TransitionType.fadeIn,t.TransitionType.fadeOut].includes(o.type)&&r.transitions.length&&r.transitions.length<2&&(i=s.TWO_TRANSITIONS_REQUIRED(o.type,r.type))})}),i)throw new Error(i)},Le=(e,i)=>g([fi],e,i);var C=({callerName:e,layer:{trim:i},shouldThrow:r=!1})=>{let o=[];if(o.push(l(e,s.SUB_FIELD(t.LayerKey.trim,t.TrimKey.start),i?.start,"number")),o.push(l(e,s.SUB_FIELD(t.LayerKey.trim,t.TrimKey.end),i?.end,"number")),o.length>0&&r)throw new Error(o[0]);return o.filter(v)},Je=(e,i)=>g([C],e,i);var Qe=(e,i)=>g([Z,w,C],e,i);var Sa=e=>e&&Object.keys(e).length===1&&t.EffectOptionKey.normalize in e&&u(e[t.EffectOptionKey.normalize],"boolean"),Ea={[t.EffectName.normalize]:Sa},ci=({callerName:e,layer:{effect:{name:i,options:r}}})=>{let o=[],n=Object.values(t.EffectName).includes(i);if(!n){let a=s.MUST_BE_TYPE(e,s.SUB_FIELD(t.LayerKey.effect,t.EffectKey.name),i,`${Object.values(t.EffectName).join(", ")}`);o.push(a)}if(n&&i in Ot&&!Ea[i](r)){let a=s.MUST_BE_TYPE(e,s.SUB_FIELD(t.LayerKey.effect,t.EffectKey.options),r,JSON.stringify(Ot[i]));o.push(a)}return o.filter(Hr)},ue=(e,i)=>g([ci],e,i);var Va=e=>e&&Object.keys(e).length===1&&t.FilterOptionKey.brightness in e&&u(e[t.FilterOptionKey.brightness],"number"),Ia=e=>e&&Object.keys(e).length===1&&t.FilterOptionKey.contrast in e&&u(e[t.FilterOptionKey.contrast],"number"),Oa=e=>e&&Object.keys(e).length===1&&t.FilterOptionKey.saturation in e&&u(e[t.FilterOptionKey.saturation],"number"),Ca={[t.FilterName.brightness]:Va,[t.FilterName.contrast]:Ia,[t.FilterName.saturation]:Oa},yi=({callerName:e,layer:{filter:{name:i,options:r}}})=>{let o=[],n=Object.values(t.FilterName).includes(i);if(!n){let a=s.MUST_BE_TYPE(e,s.SUB_FIELD(t.LayerKey.filter,t.FilterKey.name),i,`${Object.values(t.FilterName).join(", ")}`);o.push(a)}if(n&&i in Pt&&!Ca[i](r)){let a=s.MUST_BE_TYPE(e,s.SUB_FIELD(t.LayerKey.filter,t.FilterKey.options),r,JSON.stringify(Pt[i]));o.push(a)}return o.filter(v)},fe=(e,i)=>g([yi],e,i);var Ze=(e,i)=>g([U,W,w,C,Z],e,i);import Pa from"http";import Ka from"https";var jr=e=>new Promise((i,r)=>{(e.startsWith("https://")?Ka:Pa).get(e,a=>{a.statusCode===200?i(!0):i(!1)}).on("error",a=>{i(!1)})});var ve=(e,i)=>{let r=[];return r.push(l(e,s.SUB_FIELD(t.LayerKey.html,s.SUB_FIELD(t.HtmlKey.page,t.HtmlPageKey.body)),i?.body,"string")),r.push(l(e,s.SUB_FIELD(t.LayerKey.html,s.SUB_FIELD(t.HtmlKey.page,t.HtmlPageKey.styles)),i?.styles,"string")),r},gi=({callerName:e,layer:{html:{page:i,url:r,withTailwind:o,withTransparentBackground:n}}})=>{let a=[];return!i&&!r&&a.push(A.htmlPageOrUrlRequired),r&&!r.startsWith("http://")&&!r.startsWith("https://")&&a.push(A.htmlUrlProtocolRequired),ve(e,i).forEach(m=>a.push(m)),a.push(l(e,s.SUB_FIELD(t.LayerKey.html,t.HtmlKey.withTailwind),o,"boolean")),a.push(l(e,s.SUB_FIELD(t.LayerKey.html,t.HtmlKey.withTransparentBackground),n,"boolean")),a.push(l(e,s.SUB_FIELD(t.LayerKey.html,t.HtmlKey.url),r,"string")),a.filter(v)},qr=async({layer:{html:{page:e,url:i}}})=>{let r=[];if(!e&&!i&&r.push(A.htmlPageOrUrlRequired),i&&!await jr(i))throw new Error(A.htmlUrlInvalid(i));return r.filter(v)},et=(e,i)=>g([U,W,w,C,gi],e,i);var tt=(e,i)=>g([U,W,w,C],e,i);var hi=({callerName:e,layer:{lottie:i}})=>{let r=[];return r.push(l(e,t.LayerKey.lottie,i,"object")),r.filter(v)},it=(e,i)=>{g([hi,U,W,w,C],e,i)};var rt=(e,i)=>g([w],e,i);var bi=({callerName:e,layer:{subtitles:{backgroundColor:i,color:r,fontSize:o}}})=>{let n=[];return n.push(S(e,s.SUB_FIELD(t.LayerKey.subtitles,t.SubtitlesKey.backgroundColor),i,!1)),n.push(S(e,s.SUB_FIELD(t.LayerKey.subtitles,t.SubtitlesKey.color),r,!1)),n.push(l(e,s.SUB_FIELD(t.LayerKey.subtitles,t.SubtitlesKey.fontSize),o,"number")),n.filter(v)},ot=(e,i)=>g([U,bi,w,C],e,i);var Te=(e,i)=>{let r=Object.values(t.TextAlignValue);if(!r.includes(i))return s.MUST_BE_TYPE(e,s.SUB_FIELD(t.LayerKey.text,t.TextKey.textAlign),i,r.join(", "))},Ae=(e,i)=>{let r=Object.values(t.TextHorizontalPositionValue),o=Object.values(t.TextVerticalPositionValue);if(i&&i.x&&!r.includes(i.x))return s.MUST_BE_TYPE(e,s.SUB_FIELD(t.LayerKey.text,s.SUB_FIELD(t.TextKey.textPosition,"x")),i.x,r.join(", "));if(i&&i.y&&!o.includes(i.y))return s.MUST_BE_TYPE(e,s.SUB_FIELD(t.LayerKey.text,s.SUB_FIELD(t.TextKey.textPosition,"y")),i.y,o.join(", "))},we=(e,i)=>{let r=Object.values(t.FontStyleValue);if(i&&!r.includes(i))return s.MUST_BE_TYPE(e,s.SUB_FIELD(t.LayerKey.text,t.TextKey.fontStyle),i,r.join(", "))},Fe=(e,i)=>{let r=Object.values(t.FontWeightValue);if(i&&!r.includes(i))return s.MUST_BE_TYPE(e,s.SUB_FIELD(t.LayerKey.text,t.TextKey.fontWeight),i,r.join(", "))},xi=({callerName:e,layer:{text:{backgroundColor:i,backgroundTransform:r,border:o,borderRadius:n,color:a,fontFamily:f,fontSize:m,fontStyle:y,fontWeight:p,lineHeight:b,padding:c,text:T,textAlign:B,textDecoration:$,textPosition:re,textTransform:Xr}}})=>{let R=[];return R.push(S(e,s.SUB_FIELD(t.LayerKey.text,t.TextKey.backgroundColor),i,!1)),R.push(l(e,s.SUB_FIELD(t.LayerKey.text,t.TextKey.backgroundTransform),r,"string")),R.push(l(e,s.SUB_FIELD(t.LayerKey.text,t.TextKey.border),o,"string")),R.push(l(e,s.SUB_FIELD(t.LayerKey.text,t.TextKey.borderRadius),n,"number")),R.push(S(e,s.SUB_FIELD(t.LayerKey.text,t.TextKey.color),a,!1)),R.push(l(e,s.SUB_FIELD(t.LayerKey.text,t.TextKey.fontFamily),f,"string")),R.push(l(e,s.SUB_FIELD(t.LayerKey.text,t.TextKey.fontSize),m,"number")),R.push(we(e,y)),R.push(Fe(e,p)),R.push(l(e,s.SUB_FIELD(t.LayerKey.text,t.TextKey.lineHeight),b,"number")),R.push(l(e,s.SUB_FIELD(t.LayerKey.text,t.TextKey.padding),c,"number")),R.push(l(e,s.SUB_FIELD(t.LayerKey.text,t.TextKey.text),T,"string")),R.push(Te(e,B)),R.push(l(e,s.SUB_FIELD(t.LayerKey.text,t.TextKey.textDecoration),$,"string")),R.push(Ae(e,re)),R.push(l(e,s.SUB_FIELD(t.LayerKey.text,t.TextKey.textTransform),Xr,"string")),R.filter(v)},nt=(e,i)=>g([U,W,xi,w,C],e,i);var at=(e,i)=>g([U,W,w,C,Z],e,i);var Li=({callerName:e,layer:{waveform:{backgroundColor:i,color:r,style:o}}})=>{let n=[];return n.push(S(e,s.SUB_FIELD(t.LayerKey.waveform,t.WaveformKey.backgroundColor),i,!1)),n.push(S(e,s.SUB_FIELD(t.LayerKey.waveform,t.WaveformKey.color),r,!1)),n.push(be(e,s.SUB_FIELD(t.LayerKey.waveform,t.WaveformKey.style),o,Object.values(t.WaveformStyleValue))),n.filter(v)},st=(e,i)=>{g([w,Li],e,i)};var vi=e=>ki.includes(e.replace(/\./g,""));var Ti=e=>zi.includes(e.replace(/\./g,""));import ka from"ffprobe-static";import{spawn as za}from"child_process";var Ai=(e,i)=>`${J(e)}${i}`,wi=(e,i,r,o)=>{let n={...e},a={[t.LayerType.audio]:x(t.DefaultAudioOptions),[t.LayerType.filter]:x(Kt),[t.LayerType.effect]:x(Ct),[t.LayerType.group]:void 0,[t.LayerType.html]:x(t.DefaultHtmlOptions),[t.LayerType.image]:void 0,[t.LayerType.lottie]:{},[t.LayerType.sequence]:void 0,[t.LayerType.subtitles]:x(t.DefaultSubtitlesOptions),[t.LayerType.text]:x(t.DefaultTextOptions),[t.LayerType.video]:void 0,[t.LayerType.waveform]:x(t.DefaultWaveformOptions)},f={[t.LayerType.audio]:x(Ie()),[t.LayerType.effect]:x(Tr),[t.LayerType.filter]:x(Ar),[t.LayerType.group]:x(Bt()),[t.LayerType.html]:x(Oe()),[t.LayerType.image]:x(Ce()),[t.LayerType.lottie]:x(Pe()),[t.LayerType.sequence]:x(Ke()),[t.LayerType.subtitles]:x(ze()),[t.LayerType.text]:x(Re()),[t.LayerType.video]:x(Ue()),[t.LayerType.waveform]:x(He(n))},m=x(f)[i];return r&&Object.keys(r).length!==0&&(m[i]=h(a[i],r)),o&&(m=h(m,o)),m},N=async(e,i)=>{if(typeof e!="string"){let r=e.path;if(!ae(r))throw new Error(s.FILE_DOES_NOT_EXIST(r));return{filepath:r,readStream:e}}if(ii(e)){let{temporaryFilePath:r}=await Zt(e,i);return{filepath:r,readStream:te(r)}}if(!ae(e))throw new Error(s.FILE_DOES_NOT_EXIST(e));return{filepath:e,readStream:te(e)}},lt=async(e,i,r,o)=>{let n=[],a=await dt(r);if(e.trim?.start&&e.trim?.start>a&&n.push(s.INVALID_TRIM_VALUE_LESS_THAN_DURATION(e.trim?.start,a,i,o)),e.trim?.end&&e.trim?.end>a&&n.push(s.INVALID_TRIM_VALUE_GREATER_THAN_DURATION(e.trim?.end,a,i,o)),n.length>0)throw new Error(n[0]);return n.length===0},Fi=(e,i,r,o)=>{let n=e,a=i.transitions.find(c=>c.type===t.TransitionType.crossfadeIn),f=r?r.transitions.find(c=>c.type===t.TransitionType.crossfadeOut):void 0,m=o?o.transitions.find(c=>c.type===t.TransitionType.crossfadeIn):void 0,y=a?.options,p=f?.options,b=m?.options;return r&&f?(i.transitions.find(({type:c})=>c===t.TransitionType.fadeIn)===void 0&&i.addTransition({options:{duration:p?.duration},type:t.TransitionType.fadeIn}),i.setStart(n-p.duration),n=n-p.duration):o&&m?(i.transitions.find(({type:c})=>c===t.TransitionType.fadeOut)===void 0&&i.addTransition({options:{duration:b.duration},type:t.TransitionType.fadeOut}),i.setStart(n),n=n-b.duration):r&&a?(r.transitions.find(({type:c})=>c===t.TransitionType.fadeOut)===void 0&&r.addTransition({options:{duration:y.duration},type:t.TransitionType.fadeOut}),i.setStart(n-y?.duration),n=n-y?.duration):i.setStart(n),n},_i=(e,i)=>{i.audio&&wr.includes(e.type)&&e.setVolume(i.audio.volume),i.position&&Fr.includes(e.type)&&(i.position.angle&&e.setAngle(i.position.angle),i.position.angleX&&e.setAngleX(i.position.angleX),i.position.angleY&&e.setAngleY(i.position.angleY),i.position.origin&&e.setOrigin(i.position.origin),i.position.isRelative&&e.setIsRelative(i.position.isRelative),i.position.x&&e.setX(i.position.x),i.position.y&&e.setY(i.position.y),i.position.z&&e.setZ(i.position.z)),i.size&&_r.includes(e.type)&&(i.size.format&&e.setFormat(i.size.format),i.size.height&&e.setHeight(i.size.height),i.size.scale&&e.setScale(i.size.scale),i.size.width&&e.setWidth(i.size.width)),i.timeline?.start&&Dr.includes(e.type)&&e.setStart(i.timeline.start),i.transitions&&Sr.includes(e.type)&&i.transitions.forEach(r=>{e.addTransition(r)}),i.trim&&Er.includes(e.type)&&e.setTrim(i.trim.start,i.trim.end)},Di=({end:e,layer:i,scale1:r,scale2:o,start:n,x1:a,x2:f,y1:m,y2:y})=>(i.addTransition({options:{time:n,value:r},type:t.TransitionType.scale}),i.addTransition({options:{time:e,value:o},type:t.TransitionType.scale}),i.addTransition({options:{time:n,value:a},type:t.TransitionType.x}),i.addTransition({options:{time:e,value:f},type:t.TransitionType.x}),i.addTransition({options:{time:n,value:m},type:t.TransitionType.y}),i.addTransition({options:{time:e,value:y},type:t.TransitionType.y}),i),Si=(e,i)=>e.position&&i.position?e.position.z-i.position.z:0,dt=e=>new Promise((i,r)=>{let o=za(ka.path,["-v","error","-show_entries","format=duration","-of","json",e]),n="";o.stdout.on("data",a=>{n+=a}),o.stderr.on("data",a=>{console.error(`ffprobe error: ${a}`)}),o.on("close",a=>{if(a===0)try{let f=JSON.parse(n),m=parseFloat(f.format.duration);i(m)}catch(f){r(f)}else r(new Error(`ffprobe process exited with code ${a}`))})});import Ra from"find-process";import{execSync as Ei}from"child_process";import Vi from"path";var Ii=async e=>{ae(ee)?Ei("git pull",{cwd:Vi.resolve(ee),stdio:[0,1,2]}):(We(ee),Ei("git clone https://github.com/editframe/editframe-preview .",{cwd:Vi.resolve(ee),stdio:[0,1,2]})),ti(Vr,e),(await Ra("port",Ir)).length||Ei(`cd ${ee}; yarn; yarn dev`,{cwd:Vi.resolve(ee),stdio:[0,1,2]})};var mt=class{constructor(i){this._options={...i},this._fetch=i.fetch}async get({url:i}){return await this._fetch({headers:ye(this._options),url:i})}async post({data:i,isForm:r=!1,url:o}){return await this._fetch({data:i,headers:ye({...this._options,isForm:r}),method:"post",url:o})}async put({data:i,isForm:r=!1,url:o}){return await this._fetch({data:i,headers:ye({...this._options,isForm:r}),method:"put",url:o})}};var _e=class{constructor(i){this._api=i}async all(i,r){try{let o=await this._api.get({url:ne(P.applications.all,i,r)});return O(o,{invalidDataError:de.malformedResponse,validate:si}).data}catch(o){o instanceof Error&&console.error(de.get(o.message))}return[]}async get(i){try{let r=await this._api.get({url:oe(P.applications.get,{id:i})});return O(r,{invalidDataError:de.malformedResponse,validate:qe})}catch(r){r instanceof Error&&console.error(de.get(r.message))}}};import Ua from"ora";import Ha from"pusher-js";global.Pusher=Ha;var pt=class{constructor({api:i,deliverables:r,develop:o,jobs:n}){this.jobs=[];this._api=i,this.jobs=n||[],this.deliverables=r,this._develop=o,d(()=>null)}["addJob"](i){return this.jobs.push(i),this.jobs}async["run"](){let i;return K(()=>{I(this.jobs,Y.jobsRequired),zr(this.jobs,Y.jobsNotEmpty)},async()=>{this._develop&&(i=Ua("Uploading flow video configuration").start());let r=await this._api.post({data:JSON.stringify({jobs:this.jobs,deliverables:this.deliverables}),isForm:!1,url:P.flows.run});return this._develop&&i.succeed("Flow video configuration uploaded"),O(r,{invalidDataError:Y.malformedEncodingResponse,validate:pe})})}};var De=class{constructor({api:i,develop:r=!1,host:o}){this._api=i,this._host=o,this._develop=r}async["all"](i,r){try{let o=await this._api.get({url:ne(P.flows.all,i,r)});return O(o,{invalidDataError:Y.malformedResponse,validate:di}).data}catch(o){o instanceof Error&&console.error(Y.all(o.message))}return[]}async["get"]({id:i}){try{let r=await this._api.get({url:oe(P.flows.get,{id:i})});return O(r,{invalidDataError:Y.malformedResponse,validate:Ye})}catch(r){r instanceof Error&&console.error(Y.get(r.message))}}async["new"](i){return K(()=>{mi(i)},async()=>{let{deliverables:r,jobs:o}=i;return new pt({api:this._api,host:this._host,jobs:o,deliverables:r,develop:this._develop})})}};import Gr from"form-data";import Yr from"form-data";import Qa from"laravel-echo";import Za from"open";import Oi from"ora";import Ci from"pretty-ms";import es from"pusher-js";import{twMerge as ts}from"tailwind-merge";import{Mixin as Ma}from"ts-mixer";var k=class{constructor({composition:i,id:r}){this._composition=i,this._id=r}get id(){return this._id}getAttribute({childKey:i,layerKey:r}){return this._composition.getLayerAttribute({childKey:i,id:this.id,layerKey:r})}setAttribute({childKey:i,layerKey:r,value:o}){return this._composition.setLayerAttribute({childKey:i,id:this._id,layerKey:r,value:o}),this}};var ce=class extends k{constructor({composition:i,id:r}){super({composition:i,id:r})}get volume(){return this._getAudioAttribute(t.AudioKey.volume)}["setVolume"](i){return d(()=>{Ge("setVolume",{audio:{volume:i}})},()=>{let r=i;return i>1?r=1:i<0&&(r=0),this._setAudioAttribute(t.AudioKey.volume,r)})}setMuted(){return this._setAudioAttribute(t.AudioKey.volume,0)}_getAudioAttribute(i){return this.getAttribute({childKey:i,layerKey:t.LayerKey.audio})}_setAudioAttribute(i,r){return this.setAttribute({childKey:i,layerKey:t.LayerKey.audio,value:r})}};var _=class extends k{constructor({composition:i,id:r}){super({composition:i,id:r})}get timeline(){return this._composition.getLayerAttribute({id:this.id,layerKey:t.LayerKey.timeline})}get start(){return this._getTimelineAttribute(t.TimelineKey.start)}["setStart"](i=0){return d(()=>Ne("setStart",{timeline:{start:i}}),()=>this._setTimelineAttribute(t.TimelineKey.start,i))}_getTimelineAttribute(i){return this.getAttribute({childKey:i,layerKey:t.LayerKey.timeline})}_setTimelineAttribute(i,r){return this.setAttribute({childKey:i,layerKey:t.LayerKey.timeline,value:r})}};var E=class extends k{constructor({composition:i,id:r}){super({composition:i,id:r})}get transitions(){return this.getAttribute({layerKey:t.LayerKey.transitions})}["addTransition"]({options:i,type:r}){return d(()=>Le("addTransition",{transitions:[{options:i,type:r}]}),()=>this.setAttribute({layerKey:t.LayerKey.transitions,value:x([...this.transitions||[],{options:i,type:r}])}))}["setTransitions"](i){return d(()=>Le("setTransitions",{transitions:i}),()=>this.setAttribute({layerKey:t.LayerKey.transitions,value:i}))}};var V=class extends k{constructor({composition:i,id:r}){super({composition:i,id:r})}get trim(){return this._composition.getLayerAttribute({id:this.id,layerKey:t.LayerKey.trim})}["setTrim"](i=0,r=this._composition.duration){return d(()=>Je("setTrim",{trim:{end:r,start:i}}),()=>(this._setTrimAttribute(t.TrimKey.start,i<0?0:i),r&&this._setTrimAttribute(t.TrimKey.end,r),this))}_setTrimAttribute(i,r){return this.setAttribute({childKey:i,layerKey:t.LayerKey.trim,value:r})}};var ut=class extends Ma(ce,_,E,V){constructor({composition:i,id:r}){super({composition:i,id:r})}get type(){return t.LayerType.audio}};var ft=class extends k{constructor({composition:i,id:r}){super({composition:i,id:r})}get type(){return t.LayerType.effect}get name(){return this._getEffectAttribute(t.EffectKey.name)}get options(){return this._getEffectAttribute(t.EffectKey.options)}["setEffect"]({name:i,options:r}){return d(()=>ue("setEffect",{effect:{name:i,options:r}}),()=>this.setAttribute({layerKey:t.LayerKey.effect,value:{name:i,options:r}}))}_getEffectAttribute(i){return this.getAttribute({childKey:i,layerKey:t.LayerKey.effect})}};var ct=class extends k{constructor({composition:i,id:r}){super({composition:i,id:r})}get type(){return t.LayerType.filter}get name(){return this._getFilterAttribute(t.FilterKey.name)}get options(){return this._getFilterAttribute(t.FilterKey.options)}["setFilter"]({name:i,options:r}){return d(()=>fe("setFilter",{filter:{name:i,options:r}}),()=>this.setAttribute({layerKey:t.LayerKey.filter,value:{name:i,options:r}}))}_getFilterAttribute(i){return this.getAttribute({childKey:i,layerKey:t.LayerKey.filter})}};import{Mixin as Wa}from"ts-mixer";var z=class extends k{constructor({composition:i,id:r}){super({composition:i,id:r})}get angle(){return this._getPositionAttribute(t.PositionKey.angle)}get angleX(){return this._getPositionAttribute(t.PositionKey.angleX)}get angleY(){return this._getPositionAttribute(t.PositionKey.angleY)}get isRelative(){return this._getPositionAttribute(t.PositionKey.isRelative)}get origin(){return this._getPositionAttribute(t.PositionKey.origin)}get x(){return this._getPositionAttribute(t.PositionKey.x)}get y(){return this._getPositionAttribute(t.PositionKey.y)}get z(){return this._getPositionAttribute(t.PositionKey.z)}["setAngle"](i=0){return d(()=>q("setAngle",{position:{angle:i}}),()=>this._setPositionAttribute(t.PositionKey.angle,i))}["setAngleX"](i=0){return d(()=>q("setAngleX",{position:{angleX:i}}),()=>this._setPositionAttribute(t.PositionKey.angleX,i))}["setAngleY"](i=0){return d(()=>q("setAngleY",{position:{angleY:i}}),()=>this._setPositionAttribute(t.PositionKey.angleY,i))}["setIsRelative"](i=!1){return d(()=>q("setIsRelative",{position:{isRelative:i}}),()=>this._setPositionAttribute(t.PositionKey.isRelative,i))}["setX"](i){return d(()=>q("setX",{position:{x:i}}),()=>this._setPositionAttribute(t.PositionKey.x,i))}["setOrigin"](i){return d(()=>q("setOrigin",{position:{origin:i}}),()=>this._setPositionAttribute(t.PositionKey.origin,i))}["setY"](i){return d(()=>q("setY",{position:{y:i}}),()=>this._setPositionAttribute(t.PositionKey.y,i))}["setZ"](i){return d(()=>q("setZ",{position:{z:i}}),()=>this._setPositionAttribute(t.PositionKey.z,i))}_getPositionAttribute(i){return this.getAttribute({childKey:i,layerKey:t.LayerKey.position})}_setPositionAttribute(i,r){return this.setAttribute({childKey:i,layerKey:t.LayerKey.position,value:r})}};var M=class extends k{constructor({composition:i,id:r}){super({composition:i,id:r})}get dimensions(){return this._composition.getLayerAttribute({id:this.id,layerKey:t.LayerKey.size})}get format(){return this._getSizeAttribute(t.SizeKey.format)}get height(){return this._getSizeAttribute(t.SizeKey.height)}get scale(){return this._getSizeAttribute(t.SizeKey.scale)}get width(){return this._getSizeAttribute(t.SizeKey.width)}["setDimensions"]({height:i,width:r}){return d(()=>ie("setDimensions",{size:{height:i,width:r}}),()=>(this._setSizeAttribute(t.SizeKey.height,i),this._setSizeAttribute(t.SizeKey.width,r)))}["setFormat"](i){return d(()=>ie("setFormat",{size:{format:i}}),()=>this._setSizeAttribute(t.SizeKey.format,i))}["setHeight"](i){return d(()=>ie("setHeight",{size:{height:i}}),()=>this._setSizeAttribute(t.SizeKey.height,i))}["setScale"](i=1){return d(()=>ie("setScale",{size:{scale:i}}),()=>this._setSizeAttribute(t.SizeKey.scale,i))}["setWidth"](i){return d(()=>ie("setWidth",{size:{width:i}}),()=>this._setSizeAttribute(t.SizeKey.width,i))}_getSizeAttribute(i){return this.getAttribute({childKey:i,layerKey:t.LayerKey.size})}_setSizeAttribute(i,r){return this.setAttribute({childKey:i,layerKey:t.LayerKey.size,value:r})}};var yt=class extends Wa(z,M,_,E,V){constructor({composition:r,id:o,layers:n}){super({composition:r,id:o});this.layers=n}get type(){return t.LayerType.group}["setStart"](r=0){return d(()=>l("setStart",t.TimelineKey.start,r,"number",!0),()=>(this.layers.forEach(o=>{o.setStart(r)}),this.setAttribute({childKey:t.TimelineKey.start,layerKey:t.LayerKey.timeline,value:r})))}};import{Mixin as Ba}from"ts-mixer";var gt=class extends Ba(z,M,_,E,V){constructor({composition:i,id:r}){super({composition:i,id:r})}get type(){return t.LayerType.html}get page(){return this._getHtmlAttribute(t.HtmlKey.page)}get url(){return this._getHtmlAttribute(t.HtmlKey.url)}get withTailwind(){return this._getHtmlAttribute(t.HtmlKey.withTailwind)}get withTransparentBackground(){return this._getHtmlAttribute(t.HtmlKey.withTransparentBackground)}["setPage"](i){return K(()=>ve("setPage",i),async()=>(this.setHtmlAttribute(t.HtmlKey.url,void 0),this.setHtmlAttribute(t.HtmlKey.page,i)))}["setUrl"](i){return d(()=>l("setUrl",t.HtmlKey.url,i,"string",!0),()=>(this.setHtmlAttribute(t.HtmlKey.page,void 0),this.setHtmlAttribute(t.HtmlKey.url,i)))}["setWithTailwind"](i){return d(()=>l("setWithTailwind",t.HtmlKey.withTailwind,i,"boolean",!0),()=>this.setHtmlAttribute(t.HtmlKey.withTailwind,i))}["setWithTransparentBackground"](i){return d(()=>l("setWithTransparentBackground",t.HtmlKey.withTransparentBackground,i,"boolean",!0),()=>this.setHtmlAttribute(t.HtmlKey.withTransparentBackground,i))}_getHtmlAttribute(i){return this.getAttribute({childKey:i,layerKey:t.LayerKey.html})}setHtmlAttribute(i,r){return this.setAttribute({childKey:i,layerKey:t.LayerKey.html,value:r})}};import{Mixin as $a}from"ts-mixer";var ht=class extends $a(z,M,_,E,V){constructor({composition:i,id:r}){super({composition:i,id:r})}get type(){return t.LayerType.image}};import{Mixin as ja}from"ts-mixer";var bt=class extends ja(z,M,_,E,V){constructor({composition:i,id:r}){super({composition:i,id:r})}get type(){return t.LayerType.lottie}get animationData(){return this.getAttribute({layerKey:t.LayerKey.lottie})}["setAnimationData"](i){return d(()=>{I(i,s.REQUIRED_FIELD(t.LayerKey.lottie)),l("setAnimationData",t.LayerKey.lottie,i,"object")},()=>this.setAttribute({layerKey:t.LayerKey.lottie,value:i}))}};import{Mixin as qa}from"ts-mixer";var xt=class extends qa(_){constructor({composition:r,id:o,layers:n}){super({composition:r,id:o});this.layers=n}get type(){return t.LayerType.sequence}["setStart"](r=0){return d(()=>l("setStart",t.TimelineKey.start,r,"number",!0),()=>(this.layers.forEach(o=>{o.setStart(o.start+(r-this.start))}),this.setAttribute({childKey:t.TimelineKey.start,layerKey:t.LayerKey.timeline,value:r})))}};import{Mixin as Ya}from"ts-mixer";var Lt=class extends Ya(z,_,E,V){constructor({composition:i,id:r}){super({composition:i,id:r})}get type(){return t.LayerType.subtitles}get backgroundColor(){return this._getSubtitlesAttribute(t.SubtitlesKey.backgroundColor)}get color(){return this._getSubtitlesAttribute(t.SubtitlesKey.color)}get fontSize(){return this._getSubtitlesAttribute(t.SubtitlesKey.fontSize)}["setBackgroundColor"](i){return d(()=>S("setBackgroundColor",t.SubtitlesKey.backgroundColor,i,!0),()=>this._setSubtitlesAttribute(t.SubtitlesKey.backgroundColor,D(i)))}["setColor"](i){return d(()=>S("setColor",t.SubtitlesKey.color,i,!0),()=>this._setSubtitlesAttribute(t.SubtitlesKey.color,D(i)))}["setFontSize"](i){return d(()=>l("setFontSize",t.SubtitlesKey.fontSize,i,"number",!0),()=>this._setSubtitlesAttribute(t.SubtitlesKey.fontSize,i))}_getSubtitlesAttribute(i){return this.getAttribute({childKey:i,layerKey:t.LayerKey.subtitles})}_setSubtitlesAttribute(i,r){return this.setAttribute({childKey:i,layerKey:t.LayerKey.subtitles,value:r})}};import{Mixin as Ga}from"ts-mixer";var vt=class extends Ga(z,M,_,E,V){constructor({composition:i,id:r}){super({composition:i,id:r})}get type(){return t.LayerType.text}get backgroundColor(){return this._getTextAttribute(t.TextKey.backgroundColor)}get backgroundTransform(){return this._getTextAttribute(t.TextKey.backgroundTransform)}get border(){return this._getTextAttribute(t.TextKey.border)}get borderRadius(){return this._getTextAttribute(t.TextKey.borderRadius)}get color(){return this._getTextAttribute(t.TextKey.color)}get fontFamily(){return this._getTextAttribute(t.TextKey.fontFamily)}get fontSize(){return this._getTextAttribute(t.TextKey.fontSize)}get fontStyle(){return this._getTextAttribute(t.TextKey.fontStyle)}get fontWeight(){return this._getTextAttribute(t.TextKey.fontWeight)}get lineHeight(){return this._getTextAttribute(t.TextKey.lineHeight)}get padding(){return this._getTextAttribute(t.TextKey.padding)}get text(){return this._getTextAttribute(t.TextKey.text)}get textAlign(){return this._getTextAttribute(t.TextKey.textAlign)}get textDecoration(){return this._getTextAttribute(t.TextKey.textDecoration)}get textPosition(){return this._getTextAttribute(t.TextKey.textPosition)}get textTransform(){return this._getTextAttribute(t.TextKey.textTransform)}get tailwind(){return this._getTextAttribute(t.TextKey.tailwind)}["setBackgroundColor"](i){return d(()=>S("setBackgroundColor",t.TextKey.backgroundColor,i,!0),()=>this._setTextAttribute(t.TextKey.backgroundColor,D(i)))}["setBackgroundTransform"](i){return d(()=>l("setBackgroundTransform",t.TextKey.backgroundTransform,i,"string",!0),()=>this._setTextAttribute(t.TextKey.backgroundTransform,i))}["setBorder"](i){return d(()=>l("setBorder",t.TextKey.border,i,"string",!0),()=>this._setTextAttribute(t.TextKey.border,i))}["setBorderRadius"](i){return d(()=>l("setBorderRadius",t.TextKey.borderRadius,i,"number",!0),()=>this._setTextAttribute(t.TextKey.borderRadius,i))}["setColor"](i){return d(()=>S("setColor",t.TextKey.color,i,!0),()=>this._setTextAttribute(t.TextKey.color,D(i)))}["setFontFamily"](i){return d(()=>l("setFontFamily",t.TextKey.fontFamily,i,"string",!0),()=>this._setTextAttribute(t.TextKey.fontFamily,i))}["setFontSize"](i){return d(()=>l("setFontSize",t.TextKey.fontSize,i,"number",!0),()=>this._setTextAttribute(t.TextKey.fontSize,i))}["setFontStyle"](i){return d(()=>we("setFontStyle",i),()=>this._setTextAttribute(t.TextKey.fontStyle,i))}["setFontWeight"](i){return d(()=>Fe("setFontWeight",i),()=>this._setTextAttribute(t.TextKey.fontWeight,i))}["setLineHeight"](i){return d(()=>l("setLineHeight",t.TextKey.lineHeight,i,"number",!0),()=>this._setTextAttribute(t.TextKey.lineHeight,i))}["setPadding"](i){return d(()=>l("setPadding",t.TextKey.padding,i,"number",!0),()=>this._setTextAttribute(t.TextKey.padding,i))}["setText"](i){return d(()=>{I(i,A.textRequired),l("setText",t.TextKey.text,i,"string",!0)},()=>this._setTextAttribute(t.TextKey.text,i))}["setTextAlign"](i){return d(()=>Te("setTextAlign",i),()=>this._setTextAttribute(t.TextKey.textAlign,i))}["setTextDecoration"](i){return d(()=>l("setTextDecoration",t.TextKey.textDecoration,i,"string",!0),()=>this._setTextAttribute(t.TextKey.textDecoration,i))}["setTextPosition"](i){return d(()=>Ae("setTextPosition",i),()=>this._setTextAttribute(t.TextKey.textPosition,i))}["setTextTransform"](i){return d(()=>l("setTextTransform",t.TextKey.textTransform,i,"string",!0),()=>this._setTextAttribute(t.TextKey.textTransform,i))}_getTextAttribute(i){return this.getAttribute({childKey:i,layerKey:t.LayerKey.text})}_setTextAttribute(i,r){return this.setAttribute({childKey:i,layerKey:t.LayerKey.text,value:r})}};import{Mixin as Na}from"ts-mixer";var Tt=class extends Na(ce,z,M,_,E,V){constructor({composition:i,id:r}){super({composition:i,id:r})}get type(){return t.LayerType.video}};import{Mixin as Xa}from"ts-mixer";var At=class extends Xa(z,M,_,E,V){constructor({composition:i,id:r}){super({composition:i,id:r})}get type(){return t.LayerType.waveform}get backgroundColor(){return this._getWaveformAttribute(t.WaveformKey.backgroundColor)}get color(){return this._getWaveformAttribute(t.WaveformKey.color)}get style(){return this._getWaveformAttribute(t.WaveformKey.style)}["setBackgroundColor"](i){return d(()=>{S("setBackgroundColor",t.WaveformKey.backgroundColor,i,!0)},()=>this._setWaveformAttribute(t.WaveformKey.backgroundColor,D(i)))}["setColor"](i){return d(()=>{S("setColor",t.WaveformKey.color,i,!0)},()=>this._setWaveformAttribute(t.WaveformKey.color,D(i)))}["setStyle"](i){return d(()=>{l("setStyle",t.WaveformKey.style,i,"string",!0)},()=>this._setWaveformAttribute(t.WaveformKey.style,i))}_getWaveformAttribute(i){return this.getAttribute({childKey:i,layerKey:t.LayerKey.waveform})}_setWaveformAttribute(i,r){return this.setAttribute({childKey:i,layerKey:t.LayerKey.waveform,value:r})}};import Ja from"pusher-js";global.Pusher=Ja;var wt=class{constructor({api:i}){this.layers=[];this._api=i}async["addAsset"](i){return new Promise(async(r,o)=>{try{let n=he([[J(i),i],["sync","true"]]),a=await this._api.post({data:n,isForm:!0,url:P.assets});r(a)}catch(n){throw n instanceof Error&&console.error(n),o(n),n}})}get["getAllAssets"](){return""}};global.Pusher=es;var Se=class{constructor({api:i,develop:r=!1,formData:o,host:n,options:a,temporaryDirectory:f,videos:m}){this.layers=[];this._identifiedLayers=[];this._api=i,this._develop=r,this._files=[],this._formData=o,this._host=n,this._options=a,this._temporaryDirectory=f??ge(),this._videos=m,d(()=>li(this._options))}get["backgroundColor"](){return this._options.backgroundColor}get["dimensions"](){return this._options.dimensions}get["duration"](){return this._options.duration}get["extension"](){return this._options.extension}get["metadata"](){return this._options.metadata}get["identifiedLayers"](){return this._identifiedLayers}addLayer(i){this.layers.push(i)}["layer"](i){return this._identifiedLayers.find(r=>r.id&&r.id===i)}["getLayerAttribute"]({childKey:i,id:r,layerKey:o}){let n=this._identifiedLayers.find(a=>a.id===r)[o];return i?n[i]:n}["setLayerAttribute"]({childKey:i,id:r,layerKey:o,value:n}){let a=x(this.layer(r));i?a[o][i]=n:a[o]=n,this.setLayer(r,a)}async["addAudio"](i,r,o){let n=this._setLayerDefaults({layerConfig:o,layerType:t.LayerType.audio,options:r});return K(()=>{Q("addAudio",i),G("addAudio",t.AudioKey,r),Qe("addAudio",n),le("addAudio",i)},async()=>{let a=typeof i=="string"?i:void 0,{id:f}=this._addIdentifiedLayer({type:t.LayerType.audio,...n},a),{filepath:m,readStream:y}=await N(i,this._temporaryDirectory);await lt(n,"addVideo",m,a);let p=new ut({composition:this,id:f});return this._files.push({file:y,id:f}),this.addLayer(p),p})}["addFilter"](i){let r=this._setLayerDefaults({layerType:t.LayerType.filter,options:i});return d(()=>{I(i,A.optionsRequired),G("addFilter",t.FilterKey,i),fe("addFilter",r)},()=>{let{id:o}=this._addIdentifiedLayer({type:t.LayerType.filter,...r}),n=new ct({composition:this,id:o});return this.addLayer(n),n})}["addEffect"](i){let r=this._setLayerDefaults({layerType:t.LayerType.effect,options:i});return d(()=>{I(i,A.optionsRequired),G("addEffect",t.EffectKey,i),ue("addEffect",r)},()=>{let{id:o}=this._addIdentifiedLayer({type:t.LayerType.effect,...r}),n=new ft({composition:this,id:o});return this.addLayer(n),n})}["addGroup"](i,r){let o=this._setLayerDefaults({layerConfig:r,layerType:t.LayerType.group});return d(()=>{Ze("addGroup",o)},()=>{i.map(a=>_i(a,r));let{id:n}=this._addIdentifiedLayer({type:t.LayerType.group,...o});return new yt({composition:this,id:n,layers:i})})}async["addHtml"](i,r){let o=this._setLayerDefaults({layerConfig:r,layerType:t.LayerType.html,options:i});return await K(()=>{I(i,A.optionsRequired),G("addHtml",t.HtmlKey,i),et("addHtml",o),qr({layer:o})},async()=>{let{id:n}=this._addIdentifiedLayer({type:t.LayerType.html,...o}),a=new gt({composition:this,id:n});return this.addLayer(a),a})}async["addImage"](i,r){let o=this._setLayerDefaults({layerConfig:r,layerType:t.LayerType.image});return K(()=>{Q("addImage",i),tt("addImage",o),le("addImage",i)},async()=>{let n=typeof i=="string"?i:void 0,{id:a}=this._addIdentifiedLayer({type:t.LayerType.image,...o},n),{readStream:f}=await N(i,this._temporaryDirectory),m=new ht({composition:this,id:a});return this._files.push({file:f,id:a}),this.addLayer(m),m})}["addLottie"](i,r){let o=this._setLayerDefaults({layerConfig:r,layerType:t.LayerType.lottie,options:i});return d(()=>{I(i,A.optionsRequired),G("addLottie",t.LottieKey,i),it("addLottie",o)},()=>{let{id:n}=this._addIdentifiedLayer({type:t.LayerType.lottie,...o}),a=new bt({composition:this,id:n});return this.addLayer(a),a})}async["addSequence"](i,r={timeline:{start:0}}){let o=this._setLayerDefaults({layerConfig:r,layerType:t.LayerType.sequence});return await K(()=>{rt("addSequence",o)},async()=>{let n=await Promise.all(i.map(async m=>{let y=this._file(m.id),p,b;if(y){let{filepath:c}=await N(y.file,this._temporaryDirectory),T=Be(c);b=c,Ti(T)?p=await this._getMetadata(c):vi(T)&&(p=await this._getMetadata(c))}return{duration:p?p.duration:void 0,filepath:b,layer:m}})),a=o.timeline.start||0;n.map(({duration:m,filepath:y,layer:p},b)=>{let{type:c}=p;if(t.LayerKey.timeline in p){let{start:$=0}=p.timeline;$&&(a=$)}let T=b>0?n[b-1].layer:void 0,B=b<n.length-1?n[b+1].layer:void 0;if(a=Fi(a,p,T,B),y&&this._setFile(p.id,te(y)),c===t.LayerType.group&&p.setStart(a),t.LayerKey.trim in p){let{end:$,start:re=0}=p.trim;if($)a+=$-re;else if(m)a+=m-re;else throw new Error(A.trimEndRequired(c))}else if(m)a=m;else throw new Error(A.trimEndRequired(c))}),this._setDuration(a);let{id:f}=this._addIdentifiedLayer({type:t.LayerType.sequence,...o});return new xt({composition:this,id:f,layers:i})})}async["addSubtitles"](i,r,o){let n=this._setLayerDefaults({layerConfig:o,layerType:t.LayerType.subtitles,options:r});return K(()=>{Q("addSubtitles",i),G("addSubtitles",t.SubtitlesKey,r),ot("addSubtitles",n),le("addSubtitles",i)},async()=>{let{subtitles:{backgroundColor:a,color:f}}=n,m=x(n);m.subtitles.backgroundColor=D(a),m.subtitles.color=D(f);let{id:y}=this._addIdentifiedLayer({type:t.LayerType.subtitles,...m}),{readStream:p}=await N(i,this._temporaryDirectory);return this._files.push({file:p,id:y}),new Lt({composition:this,id:y})})}["addText"](i,r){let o=this._setLayerDefaults({layerConfig:r,layerType:t.LayerType.text,options:i});return d(()=>{I(i,A.optionsRequired),I(i.text,A.textRequired),G("addText",t.TextKey,i),nt("addText",o)},()=>{let{text:{backgroundColor:n,color:a,fontSize:f,fontStyle:m,fontWeight:y,padding:p,tailwind:b,textAlign:c,textDecoration:T}}=o,B=x(o);B.text.backgroundColor=D(n),B.text.color=D(a),b&&b.length>0&&(B.text.tailwind=ts(`text-[${a}] text-[${f}px] bg-[${n}] p-[${p}px] ${m} font-[${y}] text-${c} ${T} `,b));let{id:$}=this._addIdentifiedLayer({type:t.LayerType.text,...B}),re=new vt({composition:this,id:$});return this.addLayer(re),re})}async["addVideo"](i,r){let o=this._setLayerDefaults({layerConfig:r,layerType:t.LayerType.video});return K(()=>{Q("addVideo",i),at("addVideo",o),le("addVideo",i)},async()=>{let n=typeof i=="string"?i:void 0,{id:a}=this._addIdentifiedLayer({type:t.LayerType.video,...o},n),f=new Tt({composition:this,id:a}),{filepath:m,readStream:y}=await N(i,this._temporaryDirectory);return await lt(o,"addVideo",m,n),this.addLayer(f),this._files.push({file:y,id:a}),f})}async["addWaveform"](i,r,o){let n=this._setLayerDefaults({layerConfig:o,layerType:t.LayerType.waveform,options:r});return K(()=>{G("addWaveform",t.WaveformKey,r),st("addWaveform",n),i?Q("addWaveform",i):le("addWaveform",i)},async()=>{let{waveform:{backgroundColor:a,color:f,secondaryColor:m=t.Color.transparent}}=n,y=x(n);y.waveform.backgroundColor=D(a),y.waveform.color=D(f),y.waveform.secondaryColor=D(m);let p=typeof i=="string"?i:void 0,{id:b}=this._addIdentifiedLayer({type:t.LayerType.waveform,...y},p),c=new At({composition:this,id:b});if(i){let{readStream:T}=await N(i,this._temporaryDirectory);this._files.push({file:T,id:b})}return this.addLayer(c),c})}async["encode"](i){this._encodeOptions=i;let r;return K(()=>{I(this.duration,A.durationRequired)},async()=>{let o=new Date;if(this._encodeOptions?.experimental){this._develop&&(r=Oi("Uploading video configuration and assets").start());let n=new wt({api:this._api,develop:this._develop,formData:new Yr,host:this._host}),a=this.identifiedLayers.map(async p=>new Promise(async(b,c)=>{if(p.file)try{let{id:T}=await n.addAsset(p.file);p.assetId=T,b(p)}catch(T){c(T)}return b(p)})),f=await Promise.all(a);this._processDynamicTransitions();let m=new Date,y=await this._api.post({data:{config:{...this._options,layers:f}},isForm:!1,url:P.videos.new});return this._develop&&r.succeed(`Assets uploaded in ${Ci(m.getTime()-o.getTime())}`),O(y,{invalidDataError:A.malformedEncodingResponse,validate:pe})}else{this._processDynamicTransitions(),this.prepareFormData();let n=await this._api.post({data:this._formData,isForm:!0,url:P.videos.create});return O(n,{invalidDataError:A.malformedEncodingResponse,validate:pe})}},()=>ei(this._temporaryDirectory))}async["encodeSync"](i){let r,o,n,a=new URL(this._host),f={broadcaster:"pusher",cluster:"us2",forceTLS:!0};a.host.includes(".com")?f=Object.assign({},f,{key:"5351148cb5f7e6a2c18e"}):f=Object.assign({},f,{key:"133dac3e22bd7f3f7f18"});let m=new Qa({authorizer:p=>({authorize:(b,c)=>{let T=new Yr,B=new URL(this._host);B.pathname=P.ws.auth,T.append("channel_name",p.name),T.append("socket_id",b),this._api.post({data:T,isForm:!0,url:B.toString()}).then($=>{c(!1,$)}).catch($=>{c(!0,$)})}}),...f});if(this._develop&&i?.experimental===void 0&&(o=Oi("Uploading video configuration and assets").start()),!this._encodeOptions?.experimental)try{let p=new Date;r=await this.encode(i);let b=new Date;this._develop&&i?.experimental===void 0&&o.succeed(`Assets uploaded in ${Ci(b.getTime()-p.getTime())}`)}catch(p){throw this._develop&&i?.experimental!==void 0&&o.fail("Upload failed"),p}let y=new Date;return this._develop&&(n=Oi("Encoding video").start()),await new Promise((p,b)=>{m.private(`App.Models.Video.${r.id}`).notification(async c=>{if(m.disconnect(),["video.encoded","video.processed"].includes(c.type)){if(this._develop){let T=new Date(c.timestamp*1e3),B=Ci(T.getTime()-y.getTime());n.succeed(`Video encoded in ${B}`),await Za(c.stream_url)}p()}else if(c.type==="video.failed"){let T=A.videoEncodingFailed(r.id);this._develop?n.fail(T):b(T)}})}),await this._videos.get({id:r.id})}async["preview"](){await Ii(JSON.stringify({...this._options,files:this._files,layers:this._identifiedLayers}))}_addIdentifiedLayer(i,r){let o=h({file:r,id:me()},i);return this._identifiedLayers.push(o),o}_processDynamicTransitions(){return d(()=>{Xe(this._identifiedLayers)},()=>{this.layers.forEach(i=>{t.LayerKey.transitions in i&&i.transitions.length&&i.transitions.forEach(r=>{r.type===t.TransitionType.kenBurns&&Di({...r.options,layer:i}),i.setTransitions(i.transitions.filter(o=>o.type!==t.TransitionType.kenBurns))})})})}generateConfig(i=!1){let r={...this._options,layers:this._nonUtilLayers()};return i?JSON.stringify(r):r}prepareFormData(){this._files.forEach(({file:i,id:r})=>this._formData.append(Ai(i,r),i)),this._formData.append("config",JSON.stringify({...this._options,layers:this._nonUtilLayers()})),this._encodeOptions?.experimental&&this._formData.append("experimental",JSON.stringify(this._encodeOptions.experimental))}_nonUtilLayers(){return this._identifiedLayers.filter(i=>![t.LayerType.group,t.LayerType.sequence].includes(i.type)).sort(Si)}async["_getMetadata"](i){return{duration:await dt(i)}}_file(i){return this._files.find(r=>r.id&&r.id===i)}["_setDuration"](i){this._options.duration=i}["_setFile"](i,r){this._files.find(o=>o.id===i).file=r}["setLayer"](i,r){let o=x(this.identifiedLayers),n=o.findIndex(a=>a.id===i);o[n]=r,this._identifiedLayers=o}_setLayerDefaults({layerConfig:i,layerType:r,options:o}){return wi(this._options.dimensions,r,o,i)}};var Ee=class{constructor({api:i,develop:r=!1,host:o}){this._api=i,this._develop=r,this._host=o}async["all"](i,r){try{let o=await this._api.get({url:ne(P.videos.all,i,r)});return O(o,{invalidDataError:j.malformedResponse,validate:ri}).data}catch(o){o instanceof Error&&console.error(j.all(o.message))}return[]}async["get"]({id:i}){try{let r=await this._api.get({url:oe(P.videos.get,{id:i})});return O(r,{invalidDataError:j.malformedResponse,validate:je})}catch(r){r instanceof Error&&console.error(j.get(r.message))}}async["new"](i={backgroundColor:t.Color.black,extension:t.VideoExtensions.mp4,fps:30},r){return K(()=>{ai(i),r&&Q("new",r)},async()=>{let o;if(r){let n=ge(),{filepath:a,readStream:f}=await N(r,n),{duration:m,fps:y,height:p,width:b}=await this._getMetadata(f),c=x(i);c.backgroundColor=D(i.backgroundColor||t.Color.black),o=new Se({api:this._api,develop:this._develop,formData:new Gr,host:this._host,options:{...c,dimensions:{height:p,width:b},duration:m,fps:y},temporaryDirectory:n,videos:this}),await o.addVideo(te(a))}else{let{backgroundColor:n,dimensions:a,duration:f,extension:m,filename:y,fps:p,metadata:b}=i;o=new Se({api:this._api,develop:this._develop,formData:new Gr,host:this._host,options:{backgroundColor:D(n||t.Color.black),dimensions:a,duration:f,extension:m,filename:y,fps:p,metadata:b},videos:this})}return o})}async["_getMetadata"](i){let r=he([[J(i),i],["type","video"]]),o=await this._api.post({data:r,isForm:!0,url:P.metadata});return O(o,{invalidDataError:j.malformedResponse,validate:xe})}};var Nr=class{constructor({develop:i=!1,host:r=Ki,token:o,version:n=2}){this._api=new mt({fetch:Mt(Ht(r,n)),host:r,token:o,version:n}),this._host=r,this._token=o,this._version=n,this.applications=new _e(this._api),this.videos=new Ee({api:this._api,develop:i,host:this._host}),this.flows=new De({api:this._api,develop:i,host:this._host})}get host(){return this._host}get token(){return this._token}get version(){return this._version}},AT=Ri;export{AT as CommonResolutions,Nr as Editframe};
